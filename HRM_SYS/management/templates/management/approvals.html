{% extends 'management/base.html' %}
{% load crispy_forms_tags %}
{% block content %}
     <!-- create camera modal here-->

     






      <!-- partial -->
      <div class="main-panel">        
        <div class="content-wrapper">
          <div class="row">
            <div class="col-lg-12">
              <ul class="nav nav-pills mb-3">
                  <li class="nav-item"><a href="#list-view" data-toggle="tab" class="nav-link btn-outline mr-1 show active"><svg fill="#06f937" width="44px" height="34px" viewBox="0 0 16 16" id="request-refund-16px" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path id="Path_45" data-name="Path 45" d="M-16,11a2,2,0,0,0,2-2,2,2,0,0,0-2-2,2,2,0,0,0-2,2A2,2,0,0,0-16,11Zm0-3a1,1,0,0,1,1,1,1,1,0,0,1-1,1,1,1,0,0,1-1-1A1,1,0,0,1-16,8Zm2.5,4h-5A2.5,2.5,0,0,0-21,14.5,1.5,1.5,0,0,0-19.5,16h7A1.5,1.5,0,0,0-11,14.5,2.5,2.5,0,0,0-13.5,12Zm1,3h-7a.5.5,0,0,1-.5-.5A1.5,1.5,0,0,1-18.5,13h5A1.5,1.5,0,0,1-12,14.5.5.5,0,0,1-12.5,15Zm5-15h-7A2.5,2.5,0,0,0-17,2.5v3a.5.5,0,0,0,.5.5.5.5,0,0,0,.5-.5v-3A1.5,1.5,0,0,1-14.5,1h3V2A1.5,1.5,0,0,0-13,3.5,1.5,1.5,0,0,0-11.5,5V6h-1a.5.5,0,0,0-.5.5.5.5,0,0,0,.5.5h1v.5A.5.5,0,0,0-11,8a.5.5,0,0,0,.5-.5V7A1.5,1.5,0,0,0-9,5.5,1.5,1.5,0,0,0-10.5,4V3h1A.5.5,0,0,0-9,2.5.5.5,0,0,0-9.5,2h-1V1h3A1.5,1.5,0,0,1-6,2.5v5A1.5,1.5,0,0,1-7.5,9h-3a.5.5,0,0,0-.354.146L-12,10.293V9.5a.5.5,0,0,0-.5-.5.5.5,0,0,0-.5.5v2a.5.5,0,0,0,.309.462A.489.489,0,0,0-12.5,12a.5.5,0,0,0,.354-.146L-10.293,10H-7.5A2.5,2.5,0,0,0-5,7.5v-5A2.5,2.5,0,0,0-7.5,0ZM-10,5.5a.5.5,0,0,1-.5.5V5A.5.5,0,0,1-10,5.5ZM-11.5,4a.5.5,0,0,1-.5-.5.5.5,0,0,1,.5-.5Z" transform="translate(21)"></path> </g></svg>requisition</a></li>
                  <li class="nav-item"><a href="#grid-view" data-toggle="tab" class="nav-link btn-outline"><svg width="44px" height="34px" viewBox="0 0 1024 1024" class="icon" version="1.1" xmlns="http://www.w3.org/2000/svg" fill="#000000"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><path d="M106.666667 810.666667V298.666667h810.666666v512c0 46.933333-38.4 85.333333-85.333333 85.333333H192c-46.933333 0-85.333333-38.4-85.333333-85.333333z" fill="#0bef26"></path><path d="M917.333333 213.333333v128H106.666667v-128c0-46.933333 38.4-85.333333 85.333333-85.333333h640c46.933333 0 85.333333 38.4 85.333333 85.333333z" fill="#34a1f4"></path><path d="M704 213.333333m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="#B71C1C"></path><path d="M320 213.333333m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="#B71C1C"></path><path d="M704 64c-23.466667 0-42.666667 19.2-42.666667 42.666667v106.666666c0 23.466667 19.2 42.666667 42.666667 42.666667s42.666667-19.2 42.666667-42.666667V106.666667c0-23.466667-19.2-42.666667-42.666667-42.666667zM320 64c-23.466667 0-42.666667 19.2-42.666667 42.666667v106.666666c0 23.466667 19.2 42.666667 42.666667 42.666667s42.666667-19.2 42.666667-42.666667V106.666667c0-23.466667-19.2-42.666667-42.666667-42.666667z" fill="#BDBDBD"></path><path d="M473.6 753.066667c0-4.266667 0-10.666667 2.133333-14.933334 2.133333-4.266667 4.266667-8.533333 8.533334-10.666666s6.4-6.4 10.666666-6.4c4.266667-2.133333 10.666667-2.133333 14.933334-2.133334s10.666667 0 14.933333 2.133334l12.8 6.4c4.266667 2.133333 6.4 6.4 8.533333 10.666666 2.133333 4.266667 2.133333 8.533333 2.133334 14.933334 0 4.266667 0 10.666667-2.133334 14.933333-2.133333 4.266667-4.266667 8.533333-8.533333 10.666667-4.266667 2.133333-6.4 6.4-12.8 6.4s-6.4 4.266667-12.8 4.266666-10.666667 0-14.933333-2.133333c-4.266667-2.133333-8.533333-4.266667-10.666667-6.4-4.266667-2.133333-6.4-6.4-8.533333-10.666667-2.133333-6.4-4.266667-10.666667-4.266667-17.066666z m66.133333-91.733334h-55.466666l-8.533334-234.666666h70.4l-6.4 234.666666z" fill="#34a1f4"></path></g></svg>Apply Leave</a></li>
              </ul>
          </div>
          
          <div class="col-lg-12">
            <div class="row tab-content">
                <div id="list-view" class="tab-pane fade active show col-lg-12">
            <div class="col-12 grid-margin stretch-card">
              <div class="card">
                <div class="card-body">
                  <h4 class="card-title">Initiate approvals</h4>
               
                  <p class="card-description">
                    <div id="loaders5" style="display: none;">
                      <div class="spinner-grow text-primary" role="status">
                        <span class="sr-only">Loading...</span>
                      </div>
                      <div class="spinner-grow text-secondary" role="status">
                        <span class="sr-only">Loading...</span>
                      </div>
                      <div class="spinner-grow text-success" role="status">
                        <span class="sr-only">Loading...</span>
                      </div>
                    </div>
                    
                  </p>
                  <form class="forms-sample" ectype="multipart/form-data" method="POST" id="ApprovalForm">
                    {% csrf_token %}
                    
                 
                    <div class="form-group">
                       {{appForm.approvals | as_crispy_field}}
                    </div>
                    <div id="loaders10" style="display: none;">
                      <div class="spinner-grow text-primary" role="status">
                        <span class="sr-only">Loading...</span>
                      </div>
                      <div class="spinner-grow text-secondary" role="status">
                        <span class="sr-only">Loading...</span>
                      </div>
                      <div class="spinner-grow text-success" role="status">
                        <span class="sr-only">Loading...</span>
                      </div>
                    </div>
                    <div class="form-group">
                      {{appForm.media}}
                      {{appForm.details}}
                   </div>
                   <div class="form-group">
                    
                    {{appForm.attachments}}
                 </div>
        
                   
             
                   
                    <button type="submit" class="btn btn-primary mr-2" onclick="loadApproval()">Submit</button>
                    <button class="btn btn-light">Cancel</button>
                  </form>
                </div>
              </div>
            </div>
            </div>
            <div id="grid-view" class="tab-pane fade col-lg-12">
              <div class="row">
                <div class="col-12">
                  <div class="card">
                    <div class="card-body">
                      {% for setting in settings %}
                      <div style="background-color: greenyellow;">
                      <svg width="44px" height="44px" viewBox="0 0 1024 1024" class="icon" version="1.1" xmlns="http://www.w3.org/2000/svg" fill="#000000"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><path d="M182.067 383.79h664.916v473.911H182.067z" fill="#FCE3C3"></path><path d="M846.983 857.701H170.007V401.632h676.976v456.069zM189.428 838.28h638.134V421.053H189.428V838.28z" fill="#300604"></path><path d="M850.483 861.201H166.507V398.132h683.977v463.069z m-676.976-7h669.977V405.132H173.507v449.069z m657.555-12.421H185.929V417.553h645.134V841.78z m-638.133-7h631.134V424.553H192.929V834.78z" fill="#300604"></path><path d="M179.718 273.282h657.556v138.061H179.718z" fill="#300604"></path><path d="M840.774 414.844H176.219V269.782h664.556v145.062z m-657.555-7h650.556V276.782H183.219v131.062z" fill="#300604"></path><path d="M846.983 421.053H170.007V263.572h676.976v157.481z m-657.555-19.421h638.134V282.994H189.428v118.638z" fill="#300604"></path><path d="M850.483 424.553H166.507v-164.48h683.977v164.48z m-676.976-7h669.977v-150.48H173.507v150.48z m657.555-12.421H185.929V279.494h645.134v125.638z m-638.133-7h631.134V286.494H192.929v111.638z" fill="#300604"></path><path d="M672.215 190.225h63.426v162.87h-63.426z" fill="#ED8F27"></path><path d="M745.351 362.806h-82.847V180.514h82.847v182.292z m-63.426-19.421h44.005v-143.45h-44.005v143.45z" fill="#300604"></path><path d="M281.351 190.225h63.426v162.87h-63.426z" fill="#ED8F27"></path><path d="M354.487 362.806H271.64V180.514h82.847v182.292z m-63.426-19.421h44.005v-143.45h-44.005v143.45z" fill="#300604"></path><path d="M688.071 468.427h66.597v66.597h-66.597z" fill="#B12800"></path><path d="M688.071 596.369h66.597v66.597h-66.597zM688.071 724.31h66.597v66.598h-66.597zM546.156 468.427h66.597v66.597h-66.597z" fill="#228E9D"></path><path d="M546.156 596.369h66.597v66.597h-66.597z" fill="#B12800"></path><path d="M546.156 724.31h66.597v66.598h-66.597zM404.239 468.427h66.598v66.597h-66.598z" fill="#228E9D"></path><path d="M404.239 596.369h66.598v66.597h-66.598z" fill="#B12800"></path><path d="M404.239 724.31h66.598v66.598h-66.598zM262.323 596.369h66.598v66.597h-66.598z" fill="#228E9D"></path><path d="M262.323 724.31h66.598v66.598h-66.598z" fill="#B12800"></path></g></svg><strong id="annual-leave">{{setting.leave_days}}</strong>
                      days
                    </div>
                      {% endfor %}
                  </div>
                  </div>
               
                </div>
                <div class="col-12 grid-margin stretch-card" id="groups">
                  <div class="card">
                    <div class="card-body">
                      <h4 class="card-title">Apply leave</h4>
                      <p class="card-description">
                        annual,sick, compassionate
                        <h4 id="success">
                          <div id="loaders6" style="display: none;">
                            <div class="spinner-grow text-primary" role="status">
                              <span class="sr-only">Loading...</span>
                            </div>
                            <div class="spinner-grow text-secondary" role="status">
                              <span class="sr-only">Loading...</span>
                            </div>
                            <div class="spinner-grow text-success" role="status">
                              <span class="sr-only">Loading...</span>
                            </div>
                            </div>
                           
                        </h4>
                      </p>
                    <form id="leaveForm" enctype="multipart/form-data" method="POST">
                      {% csrf_token %}
    
                      {% for field in leave_form %}
                        <div class="form-group">
                           {{field | as_crispy_field}}
                        </div>
                      {% endfor %}
                        
                       
                        
                        
                       
                      
                        <button type="submit" class="btn btn-primary mr-2" onclick="loadLeave();">Submit</button>
                        <button class="btn btn-light">Cancel</button>
                      </form>
                    </div>
                  </div>
                </div>


            </div>
            </div>


            </div>
            </div>
            
          </div>
        </div>
        <!-- content-wrapper ends -->
        <!-- partial:../../partials/_footer.html -->
        <footer class="footer">
          
        </footer>
        <!-- partial -->
      </div>

    <script>
    
function loadApproval(){
  
  $("#ApprovalForm").submit(function(e){
   e.preventDefault()

   $form = $(this)
   var formData = new FormData(this);
 
   $.ajax({
     method:"post",
     url:"{% url 'management_upload_process' %}",
     data:formData,
     processData: false,
contentType: false,
beforeSend:function(){
                $("#loaders5").show()
             },
     success:function(data,status){
       alert(data)
     },
     complete:function(){
                
                $("#loaders5").hide()
                location.reload()
  
               }
   })
  })

}

var approval = document.getElementById("id_approvals")
 approval.addEventListener("change",(event) => {



 
 
  
  $.ajax({
      
       method:"post",
       url:"{% url 'management_get_approval_temp' %}",
       data:{
           approval:approval.value
       },
       beforeSend:function(){
                $("#loaders10").show()
             },
       success:function(data,status){
          
        tinyMCE.get('id_details').setContent(data);
       },
       complete:function(){
                
                $("#loaders10").hide()
                
  
               }
  })


 })

   // upload leave data 
   function loadLeave(){
  
  $("#leaveForm").submit(function(e){
   e.preventDefault()

   $form = $(this)
   var formData = new FormData(this);
 
   $.ajax({
     method:"post",
     url:"{% url 'management_upload_leave' %}",
     data:formData,
     processData: false,
contentType: false,
beforeSend:function(){
             $("#loaders6").show()
          },

     success:function(data,status){
       alert(data)
     },
     complete:function(){
             
             $("#loaders6").hide()
             

            }
   })
  })

}

// calculate number of days
var input1 = document.getElementById("id_start")
 input1.addEventListener("change",(event) => {

       var start = new Date(document.getElementById("id_start").value) 
       var end  = new Date(document.getElementById("id_end").value)
       if ((end-start)==0){

        document.getElementById("id_days").value = (end - start)/(24*3600000)+1
        document.getElementById("id_remaining_leave_days").value =parseFloat(document.getElementById("annual-leave").innerHTML) - document.getElementById("id_days").value

       }else if((end-start)>1){
        
            document.getElementById("id_days").value = (end - start)/(24*3600000)+1
            document.getElementById("id_remaining_leave_days").value =parseFloat(document.getElementById("annual-leave").innerHTML) - document.getElementById("id_days").value
       }
 })

 var input2 = document.getElementById("id_end")
 input2.addEventListener("change",(event) => {

       var start = new Date(document.getElementById("id_start").value) 
       var end  = new Date(document.getElementById("id_end").value)
       if ((end-start)==0){

        document.getElementById("id_days").value = (end - start)/(24*3600000)+1
        document.getElementById("id_remaining_leave_days").value =parseFloat(document.getElementById("annual-leave").innerHTML) - document.getElementById("id_days").value

       }else if((end-start)>1){
        
            document.getElementById("id_days").value = (end - start)/(24*3600000)+1
            document.getElementById("id_remaining_leave_days").value =parseFloat(document.getElementById("annual-leave").innerHTML) - document.getElementById("id_days").value
       }
 })

 document.getElementById("id_days").value = 1

// calculate remaining days 

console.log(parseFloat(document.getElementById("annual-leave").innerHTML) - document.getElementById("id_days").value)
document.getElementById("id_remaining_leave_days").value =parseFloat(document.getElementById("annual-leave").innerHTML) - document.getElementById("id_days").value


// hide non leave approvals
 const nonLeaveDrop = document.getElementById("id_Approvals_type")
var drops = nonLeaveDrop.querySelectorAll("option")
drops.forEach((drop)=>{
  if(!drop.innerHTML.includes("leave")){
  drop.style.display = "none"
  }
})

// hide leave approvals

const leaveDrop = document.getElementById("id_approvals")
var drops_= leaveDrop.querySelectorAll("option")
drops_.forEach((drop)=>{
  if(drop.innerHTML.includes("leave")){
  drop.style.display = "none"
  }
})
    
    </script>
  {% endblock content %}

  