{% extends 'management/base.html' %}

{% load cache %}

{% block content %}
<style>


.chat-online {
    color: #34ce57
}

.chat-offline {
    color: #e4606d
}

.chat-messages {
    display: flex;
    flex-direction: column;
    max-height: 800px;
    overflow-y: scroll
}

.chat-message-left,
.chat-message-right {
    display: flex;
    flex-shrink: 0
}

.chat-message-left {
    margin-right: auto
}

.chat-message-right {
    flex-direction: row-reverse;
    margin-left: auto
}
.py-3 {
    padding-top: 1rem!important;
    padding-bottom: 1rem!important;
}
.px-4 {
    padding-right: 1.5rem!important;
    padding-left: 1.5rem!important;
}
.flex-grow-0 {
    flex-grow: 0!important;
}
.border-top {
    border-top: 1px solid #dee2e6!important;
}
.face{
            width: 200px;
            height:200px;
            display: inline-block;
            position: relative;
            background-color: rgb(111, 159, 178);
            border-radius: 50%;
            box-shadow:inset 2px 2px 10px #0a5f01, inset 20px 20px 50px #01ed40;
        }
        .face::after{
            content: "";
            position: absolute;
            width:90px;
            height: 100px;
            transform: rotate(-20deg);
            background-color: #000;
            left:0;
            animation: animation1 0.3s infinite;
            border-radius: 50px 50px 0px 0px;
            top: -20px;
            z-index: -100;
        }
        .face::before{
            content: "";
            position: absolute;
            width:90px;
            height: 100px;
            transform: rotate(20deg);
            background-color: #000;
            animation: animation 0.3s infinite;
            right:0;
            border-radius: 50px 50px 0px 0px;
            top: -20px;
            z-index: -100;
        }
        .eye1{
            position: absolute;
            width: 50px;
            height: 30px;
            background-color: aliceblue;
            border: 3px solid #000;
            border-radius: 50%;
            text-align: center;
            top:40px;
            left:30px;
            border-top: 30px solid #000000;
        }

        .eye1::before{
            content:"";
            position: absolute;
            width:10px;
            height: 10px;
            top: 30%;
            left: 30%;
            animation: animation 0.3s infinite;
            border-radius: 50%;
            transition: 0.5s;
            border:5px solid #000;
            background-color: #9b9999;
        }
        .eye2{
            position: absolute;
            width: 50px;
            height: 30px;
            background-color: aliceblue;
            border: 3px solid #000;
            border-radius: 50%;
            text-align: center;
            border-top: 30px solid #000000;
            top:40px;
            right:30px;
        }
        .eye2::before{
            content:"";
            position: absolute;
            width:10px;
            height: 10px;
            animation: animation 0.3s infinite;
            top: 30%;
            right: 30%;
            border-radius: 50%;
            border:5px solid #000;
            background-color: #9b9999;
        }
        .nose{
            position: absolute;
            width:60px;
            height: 50px;
            background-color: #000;
            border-radius: 50%;
            top: 50%;
            left:35%;
            border-top: 3px solid #fff;
        }
        .mouth{
            position: absolute;
            width:150px;
            height: 100px;
            background-color: transparent;
            top:35%;
            left:15%;
            border-bottom: 10px solid #000;
            animation: animation2 3s infinite;
            border-radius: 50%;
        }
        @keyframes animation{
            0%{
                transform:rotate(20deg) scale(1);
            }
          
            100%{
               
                transform: rotate(20deg) scale(1.2);
            }
        }
        @keyframes animation1{
            0%{
                transform:rotate(-20deg) scale(1);
            }
          
            100%{
               
                transform: rotate(-20deg) scale(1.2);
            }
        }
        @keyframes animation2{
            0%{
                border-radius: 30px;
            }
          
            100%{
               
                border-radius: 100%;
            }
        }
#profilez{
    overflow-y: scroll;
    scrollbar-width: none; /* Firefox */
    -ms-overflow-style: none;  /* Internet Explorer 10+ */
}
#profilez::-webkit-scrollbar { /* WebKit */
    width: 0;
    height: 0;
}

</style>


    <div class="main-panel">

		<h1 class="h3 mb-3">New Messages</h1>
        <div class="row">
           
            
             
               
                <div class="col-md-6 stretch-card grid-margin" >
                    <input  id="new" list="users" type="text" class="form-control" placeholder="To" required>
                    <datalist id="users">
                        {% cache 600 profile_list %}
                      {% for profile in profiles %}
                        <option value="{{profile.user.id}}">{{profile.first}}@{{profile.user.username}}</option>
                      {% endfor %}
                      {% endcache %}

                    </datalist>
                </div>
                <br>
                <br>
                <div class="col-md-6 stretch-card grid-margin" >
                   <button class="btn btn-primary" onclick="newMessage()">+ conversation</button>
                </div>
                <br>
                <br>
                <div id="newConvo">

                </div>

            
          </div>
       
       

	<div class="row">
				
                    
					<div class="px-4 d-none d-md-block">
						<div class="d-flex align-items-center">
							
						</div>
					</div>
					

                        <div class="table-responsive" style="margin-left:50px;">
                            <table class="table table-striped" id="chatTab">
                              <thead>
                                <tr>
                                  <th>
                                  sender
                                  </th>
                                 
                                  <th>
                                    seen
                                  </th>
                                  <th>
                                    inbox
                                  </th>
                                  <th>
                                    time
                                  </th>
                            </tr>
                           

                            </thead>
                            <tbody>
                                {% for message in messages %}
                                {% if anonymous == true %}
                                <tr>
                                    <td>
                                        {{message.sender.user.username}}@{{message.sender.first}}
                                    </td>
                                    <!--
                                    {% if message.body|length >= 50 %}
                                    <td>
                                        <p style="color:yellowgreen; font-weight:bold;">{{message.body|slice:"0:50"|safe}}</p>
                                    </td>
                                    {% else %}
                                    <td>
                                        <p style="color:yellowgreen; font-weight:bold;">{{message.body|safe}}</p>
                                    </td>
                                    {% endif %}
                                -->
                                    <td>
                                        {{message.seen}}
                                    </td>
                                    
                                    <td>
                                        <a href="{% url 'management_live_chat_user' message.sender.user.id %}"><svg width="64px" height="64px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path opacity="0.5" d="M12 23C18.0751 23 23 18.0751 23 12C23 5.92487 18.0751 1 12 1C5.92487 1 1 5.92487 1 12C1 13.7596 1.41318 15.4228 2.14781 16.8977C2.34303 17.2897 2.40801 17.7377 2.29483 18.1607L1.63966 20.6093C1.35525 21.6723 2.32772 22.6447 3.39068 22.3603L5.83932 21.7052C6.26233 21.592 6.71033 21.657 7.10228 21.8522C8.5772 22.5868 10.2404 23 12 23Z" fill="#0135df"></path> <path d="M10.9 12.0004C10.9 12.6079 11.3925 13.1004 12 13.1004C12.6075 13.1004 13.1 12.6079 13.1 12.0004C13.1 11.3929 12.6075 10.9004 12 10.9004C11.3925 10.9004 10.9 11.3929 10.9 12.0004Z" fill="#0135df"></path> <path d="M6.5 12.0004C6.5 12.6079 6.99249 13.1004 7.6 13.1004C8.20751 13.1004 8.7 12.6079 8.7 12.0004C8.7 11.3929 8.20751 10.9004 7.6 10.9004C6.99249 10.9004 6.5 11.3929 6.5 12.0004Z" fill="#0135df"></path> <path d="M15.3 12.0004C15.3 12.6079 15.7925 13.1004 16.4 13.1004C17.0075 13.1004 17.5 12.6079 17.5 12.0004C17.5 11.3929 17.0075 10.9004 16.4 10.9004C15.7925 10.9004 15.3 11.3929 15.3 12.0004Z" fill="#0135df"></path> </g></svg></a>
                                    </td>
                                    <td>
                                        {{message.sent}}
                                    </td>
                                </tr>
                                {% else %}
                                <tr>
                                    <td>
                                        {{message.anonymous_sender.user.username}}@{{message.anonymous_sender.first}}
                                    </td>
                                    <!--
                                    {% if message.body|length >= 50 %}
                                    <td>
                                        <p style="color:yellowgreen; font-weight:bold;">{{message.body|slice:"0:50"|safe}}</p>
                                    </td>
                                    {% else %}
                                    <td>
                                        <p style="color:yellowgreen; font-weight:bold;">{{message.body|safe}}</p>
                                    </td>
                                    {% endif %}
                                -->
                                    <td>
                                        {{message.seen}}
                                    </td>
                                    
                                    <td>
                                        <a href="{% url 'management_live_chat_user' message.anonymous_sender.user.id %}"><svg width="64px" height="64px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path opacity="0.5" d="M12 23C18.0751 23 23 18.0751 23 12C23 5.92487 18.0751 1 12 1C5.92487 1 1 5.92487 1 12C1 13.7596 1.41318 15.4228 2.14781 16.8977C2.34303 17.2897 2.40801 17.7377 2.29483 18.1607L1.63966 20.6093C1.35525 21.6723 2.32772 22.6447 3.39068 22.3603L5.83932 21.7052C6.26233 21.592 6.71033 21.657 7.10228 21.8522C8.5772 22.5868 10.2404 23 12 23Z" fill="#0135df"></path> <path d="M10.9 12.0004C10.9 12.6079 11.3925 13.1004 12 13.1004C12.6075 13.1004 13.1 12.6079 13.1 12.0004C13.1 11.3929 12.6075 10.9004 12 10.9004C11.3925 10.9004 10.9 11.3929 10.9 12.0004Z" fill="#0135df"></path> <path d="M6.5 12.0004C6.5 12.6079 6.99249 13.1004 7.6 13.1004C8.20751 13.1004 8.7 12.6079 8.7 12.0004C8.7 11.3929 8.20751 10.9004 7.6 10.9004C6.99249 10.9004 6.5 11.3929 6.5 12.0004Z" fill="#0135df"></path> <path d="M15.3 12.0004C15.3 12.6079 15.7925 13.1004 16.4 13.1004C17.0075 13.1004 17.5 12.6079 17.5 12.0004C17.5 11.3929 17.0075 10.9004 16.4 10.9004C15.7925 10.9004 15.3 11.3929 15.3 12.0004Z" fill="#0135df"></path> </g></svg></a>
                                    </td>
                                    <td>
                                        {{message.sent}}
                                    </td>
                                </tr>
                                {% endif %}
                                {% endfor %}
                            </tbody>
                        </table>
                        </div>
                    <!--
                    {% for profile in profiles %}
					<a href="{% url 'management_live_chat_user' profile.user.id %}" class="list-group-item list-group-item-action border-0" style="width:100%; background-color: #01ed40;">
						<div class="flexi">
                        <div class="badge bg-success float-right" id="chats-no" style="color:black"></div>
                        
						<div class="d-flex align-items-start" id="profileDiv">
                         
							<img src="{{profile.image.url}}" class="rounded-circle mr-1"  width="40" height="40">
							<div class="flex-grow-1 ml-3">
								{% if profile.user.username == request.user.username %}
								me
								{% else %}
								<p>{{profile.user.username}}</p>
								{% endif %}
                            
								<div class="small"><span class="fas fa-circle chat-online"></span> @{{profile.first}}</div>

                            </div>
                           
						</div>
                        </div>
					</a>
                    {% endfor %}
                -->
					
                   

					<hr class="d-block d-lg-none mt-1 mb-0">
				
				
			</div>
		</div>
	</div>
    <script src="https://code.jquery.com/jquery-3.7.0.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap4.min.js"></script>
<script>

  
	
     new DataTable('#chatTab');
     /**
	function getLatest(){

		var url = "{% url 'management_chat_notify' %}"

		$.get(url,

           function(data,status){
           
           var numbers = data["no"]
           var msgs = data["msg"]
           var sender = data["sender"]
           var dates = data["dates"]
           var pks = data["pks"]
          
         

           	var noChatDiv = document.getElementsByClassName("badge bg-success float-right")
            
			var sum = 0
			for(var i=0;i<numbers.length;i++){ 
				
				sum += parseInt(numbers[i])

			}
            console.log(sum)
			document.getElementById("unread").innerHTML = sum

           
              
            $("#not-p").html(`
            

            <a class="dropdown-item preview-item" href="live_chat" style="background-color:yellowgreen">
        <p>${sender[sender.length-1]}</p>
         <div class="preview-item-content">
           <h6 class="preview-subject font-weight-normal">latest message</h6>
           <p class="font-weight-light small-text mb-0 text-muted">
            sent on ${dates[dates.length-1]}
           </p>
         </div>
     </a>`

            )

			
           }

			)
	}

	**/
   function newMessage(){
    
      var id = document.getElementById("new").value
      var link = 'live_chat/live_chat_user/'+id 

      document.getElementById("newConvo").innerHTML = `
        
           <a href='${link}' class='btn btn-outline' style="color:green"> click here start new conversation</a>
      `
        
   }
   function search(){
          var value = $("#pname").val()
              var value=value.toLowerCase();
              //alert(value)
              $('.flexi').addClass('invisible')
                .removeClass('visible')
                .filter(':contains(' + value  + ')')
                .removeClass('invisible')
                .addClass('visible');
      
          
        }

</script>

{% endblock content %}
