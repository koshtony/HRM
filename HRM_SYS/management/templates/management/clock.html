{% extends 'management/base.html' %}
{% load crispy_forms_tags %}
{% block content %}
     <!-- create camera modal here-->

     
      
    


<style>
 $crimson: #dc143c;

.center {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}

@keyframes glow {
  0% {
    box-shadow: 0 0 0 0 $crimson;
  }
  
  50% {
    box-shadow: 0 0 30px 0 $crimson;
  }
}

.btn {
  background: none;
  color: inherit;
  font: inherit;
  border: none;
  outline: none;
  cursor: pointer;
}

.btn-glow {
  background: $crimson;
  color: #fff;
  font-size: 1.6em;
  font-weight: 600;
  text-transform: uppercase;
  padding: 16px 34px;
  box-shadow: 0 0 0 0 $crimson;
  animation: glow 1.4s ease-out infinite;
}
</style>
<script type="text/javascript" src="https://unpkg.com/webcam-easy/dist/webcam-easy.min.js"></script>



      <!-- partial -->
      <div class="main-panel">        
        <div class="content-wrapper">
          <div class="row">
            <div class="col-lg-12">
              <h4 class="card-title" id="timenow">clock in <i class="fa fa-clock"></i></h4>
              <img style="width: 50px; border-radius: 50%;" src="{{user.profile.image.url}}">
              <marquee width="80%" direction="right" height="20px" id="statuss">
                clock in and out
                </marquee>
                <p style="color:white; font-weight: bold;" id="timenow"></p>
              <br>
              <br>
          </div>
          
            <div class="col-md-4 grid-margin stretch-card">
              <div class="card">
                <div class="card-body">
                  <h4 class="card-title">Camera set</h4>
                  <p class="card-description">
                   capture image to complete process
                  </p>
                  <div class="row">
                    <div class="col" style="border-color:green; border-style:dotted;">
                      <video id="video"  style="height:100%; width:100%" autoplay></video>
                    </div>
                    
                    
                  
                  
                </div>
                <br>
                <div class="col">
                  <button class="btn btn-primary" id="click-photo"><svg viewBox="0 0 1024 1024" class="icon" version="1.1"  height="50px" width="50px" xmlns="http://www.w3.org/2000/svg" fill="#000000"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><path d="M845 166l-49-13 49-13 13-48 13 48 48 13-48 13-13 49-13-49zM892 219l-18-4 18-5 5-19 4 19 19 5-19 4-4 19-5-19z" fill="#FDCD60"></path><path d="M79 711l-20-5 20-5 5-20 5 20 21 5-21 5-5 21-5-21zM148 862l-33-8 33-7 7-33 8 33 33 7-33 8-8 33-7-33z" fill="#FDCD60"></path><path d="M143 169m-9 0a9 9 0 1 0 18 0 9 9 0 1 0-18 0Z" fill="#5546CB"></path><path d="M889 854a25 25 0 1 1 25-25 25 25 0 0 1-25 25z m0-36a10 10 0 1 0 10 10 10 10 0 0 0-10-10z" fill="#5546CB"></path><path d="M166 400v347a31 31 0 0 0 31 31h629a31 31 0 0 0 31-31V400z m362 358c-92 0-168-75-168-168s75-168 168-168 168 75 168 168-76 168-168 168zM858 380v-63a31 31 0 0 0-31-31H198a31 31 0 0 0-31 31v63z m-140-58h71v20h-71z" fill="#FDCD60"></path><path d="M826 266h-40l-15-59H653l-15 59H198a51 51 0 0 0-51 51v430a51 51 0 0 0 51 51h628a51 51 0 0 0 51-51V317a51 51 0 0 0-51-51z m-157-39h86l10 37H660z m-471 59h628a31 31 0 0 1 31 31v63H166v-63a31 31 0 0 1 32-31z m628 492H198a31 31 0 0 1-31-31V400h691v347a31 31 0 0 1-32 31z" fill="#5546CB"></path><path d="M528 443c-81 0-148 66-148 148s66 148 148 148 148-66 148-148-67-148-148-148z m0 264a116 116 0 1 1 116-117 116 116 0 0 1-116 116z" fill="#FFFFFF"></path><path d="M528 423c-92 0-168 75-168 168s75 168 168 168 168-75 168-168-76-168-168-168z m0 315c-81 0-148-66-148-148s66-148 148-148 148 66 148 148-67 148-148 148z" fill="#5546CB"></path><path d="M528 494a96 96 0 1 0 96 96 96 96 0 0 0-96-96z m43 81a18 18 0 1 1 18-18 18 18 0 0 1-18 18z" fill="#FF8859"></path><path d="M528 474a116 116 0 1 0 116 116 116 116 0 0 0-116-116z m0 212a96 96 0 1 1 96-96 96 96 0 0 1-96 96z" fill="#5546CB"></path><path d="M571 558m-18 0a18 18 0 1 0 36 0 18 18 0 1 0-36 0Z" fill="#FFFFFF"></path><path d="M755 227h-86l-9 37h105l-10-37z" fill="#AFBCF3"></path><path d="M718 322h71v20h-71z" fill="#5546CB"></path></g></svg></button>
                  </div>
              </div>
            </div>
            </div>
            <div class="col-md-4 grid-margin stretch-card">
              <div class="card">
                <div class="card-body">
                  <h4 class="card-title">Captured Image</h4>
                  <p class="card-description">
                   submit captured image
                  </p>
                  <div id="loaders8" style="display: none;">
                    <div class="spinner-grow text-primary" role="status">
                      <span class="sr-only">Loading...</span>
                    </div>
                    <div class="spinner-grow text-secondary" role="status">
                      <span class="sr-only">Loading...</span>
                    </div>
                    <div class="spinner-grow text-success" role="status">
                      <span class="sr-only">Loading...</span>
                    </div>
                    </div>
                  <div class="row">
                  <div class="col" style="border-color:blue; border-style:dotted">

                    <canvas id="canvas"  style="height:100%; width:100%" ></canvas>
                  </div>
                  <audio id="snapSound" src="https://www.fesliyanstudios.com/play-mp3/1644" preload = "auto"></audio>
                </div>
                <br>
                <div class="row">
                  
                <div class="col">
                  <button class="btn btn-primary" onclick="subClockin();"><svg viewBox="0 0 24 24" fill="none" height="50px" width="50px" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path fill-rule="evenodd" clip-rule="evenodd" d="M18.1716 1C18.702 1 19.2107 1.21071 19.5858 1.58579L22.4142 4.41421C22.7893 4.78929 23 5.29799 23 5.82843V20C23 21.6569 21.6569 23 20 23H4C2.34315 23 1 21.6569 1 20V4C1 2.34315 2.34315 1 4 1H18.1716ZM4 3C3.44772 3 3 3.44772 3 4V20C3 20.5523 3.44772 21 4 21L5 21L5 15C5 13.3431 6.34315 12 8 12L16 12C17.6569 12 19 13.3431 19 15V21H20C20.5523 21 21 20.5523 21 20V6.82843C21 6.29799 20.7893 5.78929 20.4142 5.41421L18.5858 3.58579C18.2107 3.21071 17.702 3 17.1716 3H17V5C17 6.65685 15.6569 8 14 8H10C8.34315 8 7 6.65685 7 5V3H4ZM17 21V15C17 14.4477 16.5523 14 16 14L8 14C7.44772 14 7 14.4477 7 15L7 21L17 21ZM9 3H15V5C15 5.55228 14.5523 6 14 6H10C9.44772 6 9 5.55228 9 5V3Z" fill="#040ac3"></path> </g></svg></button>
                </div>
                </div>
                <br>
                

            </div>
            </div>
            </div>
            <div class="col-md-4 grid-margin stretch-card" id="list-view">
              <div class="card">
                <div class="card-body">
                
                  <form class="forms-sample" style="display:block">
                    <div class="form-group">
                      <input type="text" class="form-control" id="lat1" readonly>
                      
                   </div>
                   <div class="form-group">
                    <input type="text" class="form-control" id="long1" readonly>
                    
                 </div>
                    <div class="form-group">
                     <input type="text" class="form-control" id="longitudes" readonly>
                     
                  </div>
                  <div class="form-group">
                    
                    <input type="text" class="form-control" id="latitudes" readonly>
                    
                 </div>
                 <div class="form-group">
                  <input type="text" class="form-control" id="image_info" readonly>
                  
               </div>
               <div class="form-group">
                <input type="text" class="form-control" id="my_ip" readonly>
                
             </div>
                  </form>
                  <div>

                   

                  </div>
                  <p class="card-description" style="color:gree" id="video_msg">
                   
                  </p>
                  <div>
                    <p style="color:green">set clock in > <span id="h1"></span>:<span id="m1"></span></p>
                    <p style="color:green">set clock out > <span id="h2">:</span><span id="m2"></span></p>
                  <a class="ti-eye" onclick="getClock();">view</a>
                  <div>
                  <div>
                  <i class="ti-alarm-clock" style="color:green" id="in"></i>
                  </div>
                  <div>
                    <i class="ti-alarm-clock" style="color:blue" id="out"></i>
                    </div>
                  </div>
                  </div>
                  <!--
                  <button class="btn btn-primary btn-circle" style="margin: 5px;width:100%;height:400px;border-radius:35px; background-color:yellowgreen;" >
                     <p style="color:white; font-weight: bold;" id="timenow"></p>
                    <svg width="113px" height="113px" viewBox="0 0 1024 1024" class="icon" version="1.1" xmlns="http://www.w3.org/2000/svg" fill="#000000"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><path d="M228.1 217.7h570.1V713H228.1z" fill="#D5D9CF"></path><path d="M803.6 718.4H222.7v-506h580.9v506z m-570.2-10.7h559.4V223.1H233.4v484.6z" fill="#333336"></path><path d="M765.6 182.7H258.4c-39.1 0-71 32-71 71v432.5c0 39.1 32 71 71 71h507.3c39.1 0 71-32 71-71V253.7c0-39.1-32-71-71.1-71zM770 656c0 19-15.5 34.5-34.5 34.5H288.6c-19 0-34.5-15.5-34.5-34.5V283.9c0-19 15.5-34.5 34.5-34.5h446.9c19 0 34.5 15.5 34.5 34.5V656z" fill="#68A240"></path><path d="M765.6 762.6H258.4c-42.1 0-76.4-34.3-76.4-76.4V253.7c0-42.1 34.3-76.4 76.4-76.4h507.3c42.1 0 76.4 34.3 76.4 76.4v432.5c-0.1 42.1-34.3 76.4-76.5 76.4zM258.4 188c-36.2 0-65.7 29.5-65.7 65.7v432.5c0 36.2 29.5 65.7 65.7 65.7h507.3c36.2 0 65.7-29.5 65.7-65.7V253.7c0-36.2-29.5-65.7-65.7-65.7H258.4z m477 507.9H288.6c-22 0-39.9-17.9-39.9-39.9V283.9c0-22 17.9-39.9 39.9-39.9h446.9c22 0 39.9 17.9 39.9 39.9V656c-0.1 22-18 39.9-40 39.9zM288.6 254.8c-16.1 0-29.1 13.1-29.1 29.1V656c0 16.1 13.1 29.1 29.1 29.1h446.9c16.1 0 29.1-13.1 29.1-29.1V283.9c0-16.1-13.1-29.1-29.1-29.1H288.6z" fill="#333336"></path><path d="M512 309.1c-3 0-5.4-2.4-5.4-5.4v-54.3c0-3 2.4-5.4 5.4-5.4 3 0 5.4 2.4 5.4 5.4v54.3c0 3-2.4 5.4-5.4 5.4zM512 695.4c-3 0-5.4-2.4-5.4-5.4v-54.3c0-3 2.4-5.4 5.4-5.4 3 0 5.4 2.4 5.4 5.4V690c0 3-2.4 5.4-5.4 5.4z" fill="#333336"></path><path d="M255.9 469.9h54.3" fill="#68A240"></path><path d="M310.2 475.3h-54.3c-3 0-5.4-2.4-5.4-5.4 0-3 2.4-5.4 5.4-5.4h54.3c3 0 5.4 2.4 5.4 5.4-0.1 3-2.5 5.4-5.4 5.4z" fill="#333336"></path><path d="M715.7 469.9H770" fill="#68A240"></path><path d="M770 475.3h-54.3c-3 0-5.4-2.4-5.4-5.4 0-3 2.4-5.4 5.4-5.4H770c3 0 5.4 2.4 5.4 5.4-0.1 3-2.5 5.4-5.4 5.4z" fill="#333336"></path><path d="M512 469.9m-65.5 0a65.5 65.5 0 1 0 131 0 65.5 65.5 0 1 0-131 0Z" fill="#FFD632"></path><path d="M512 540.8c-39.1 0-70.8-31.8-70.8-70.8s31.8-70.8 70.8-70.8 70.8 31.8 70.8 70.8-31.7 70.8-70.8 70.8z m0-131c-33.1 0-60.1 27-60.1 60.1s27 60.1 60.1 60.1 60.1-27 60.1-60.1-27-60.1-60.1-60.1z" fill="#333336"></path><path d="M512 469.9m-24.3 0a24.3 24.3 0 1 0 48.6 0 24.3 24.3 0 1 0-48.6 0Z" fill="#D5D9CF"></path><path d="M512 499.6c-16.3 0-29.6-13.3-29.6-29.6s13.3-29.6 29.6-29.6 29.6 13.3 29.6 29.6-13.3 29.6-29.6 29.6z m0-48.6c-10.4 0-18.9 8.5-18.9 18.9s8.5 18.9 18.9 18.9c10.4 0 18.9-8.5 18.9-18.9S522.4 451 512 451z" fill="#333336"></path><path d="M663.3 475.3H538.8c-3 0-5.4-2.4-5.4-5.4 0-3 2.4-5.4 5.4-5.4h124.5c3 0 5.4 2.4 5.4 5.4-0.1 3-2.5 5.4-5.4 5.4z" fill="#333336"></path><path d="M487.7 445.7l-143.6-99.8" fill="#D5D9CF"></path><path d="M487.7 451c-1.1 0-2.1-0.3-3.1-1L341 350.2c-2.4-1.7-3-5-1.3-7.5 1.7-2.4 5-3 7.5-1.3l143.6 99.8c2.4 1.7 3 5 1.3 7.5-1 1.5-2.7 2.3-4.4 2.3z" fill="#333336"></path><path d="M724.9 841.3H300.8c-14.5 0-24.9-13.9-20.8-27.8l16.7-56.3H729l16.7 56.3c4.1 13.9-6.3 27.8-20.8 27.8z" fill="#FFD632"></path><path d="M724.9 846.7H300.8c-8.6 0-16.5-4-21.6-10.9-5.1-6.9-6.7-15.6-4.3-23.8l17.8-60.1H733l17.8 60.1c2.4 8.3 0.9 16.9-4.3 23.8-5.1 6.9-13 10.9-21.6 10.9z m-424.2-84.1L285.2 815c-1.5 5-0.5 10.2 2.6 14.4 3.1 4.2 7.9 6.5 13 6.5h424.1c5.2 0 9.9-2.4 13.1-6.5 3.1-4.2 4-9.4 2.6-14.4L725 762.6H300.7z" fill="#333336"></path></g></svg>
                  </button>
                -->
                </div>
              </div>
            </div>
            <div class="col-12 grid-margin stretch-card" id="groups">
              <div class="card">
                <div class="card-body">
                  <h4 class="card-title">Apply leave</h4>
                  <p class="card-description">
                    annual,sick, compassionate
                    <h4 id="success">
                      <div id="loaders6" style="display: none;">
                        <div class="spinner-grow text-primary" role="status">
                          <span class="sr-only">Loading...</span>
                        </div>
                        <div class="spinner-grow text-secondary" role="status">
                          <span class="sr-only">Loading...</span>
                        </div>
                        <div class="spinner-grow text-success" role="status">
                          <span class="sr-only">Loading...</span>
                        </div>
                        </div>
                       
                    </h4>
                  </p>
                <form id="leaveForm" enctype="multipart/form-data" method="POST">
                  {% csrf_token %}

                  {% for field in leave_form %}
                    <div class="form-group">
                       {{field | as_crispy_field}}
                    </div>
                  {% endfor %}
                    
                   
                    
                    
                   
                  
                    <button type="submit" class="btn btn-primary mr-2" onclick="loadLeave();">Submit</button>
                    <button class="btn btn-light">Cancel</button>
                  </form>
                </div>
              </div>
            </div>
            
          </div>
        </div>
        <!-- content-wrapper ends -->
        <!-- partial:../../partials/_footer.html -->
        <footer class="footer">
          
        </footer>
        <!-- partial -->
      </div>

    <script>
      // creating live clock
    
getClock()
getLoc()
      function startTime() {
          const today = new Date();
          
          let h = today.getHours();
          let min = today.getMinutes();
          let sec = today.getSeconds();
          console.log(min)
          m = checkTime(min);
          s = checkTime(sec);
          document.getElementById('timenow').innerHTML =  h + ":" + m + ":" + s+ "";
          if((h>=document.getElementById("h1").innerHTML && min>document.getElementById("m1").innerHTML) && (document.getElementById("in").innerHTML == "" && h<=document.getElementById("h2").innerHTML)){
            document.getElementById('timenow').style.color = "red";
            document.getElementById('timenow').innerHTML =  h + ":" + m + ":" + s+ "late";
          }else if((h>=document.getElementById("h2").innerHTML && min>document.getElementById("m2").innerHTML) || document.getElementById("in").innerHTML != ""){
            document.getElementById('timenow').innerHTML =  h + ":" + m + ":" + s+ " clock out";

          }else if((document.getElementById("in").innerHTML != "" && document.getElementById("in").innerHTML != "") && (h>=document.getElementById("h2").innerHTML && min>document.getElementById("m2").innerHTML) ){
                
            document.getElementById('timenow').innerHTML =  h + ":" + m + ":" + s+ "complete";
          }else if ((h>=document.getElementById("h2").innerHTML && min>document.getElementById("m2").innerHTML) && (document.getElementById("in").innerHTML == "" && h<24)){
                 
            document.getElementById('timenow').innerHTML =  h + ":" + m + ":" + s+ "missed clock in";
          }
          else if((document.getElementById("in").innerHTML != "" && document.getElementById("in").innerHTML != "") && (h<=document.getElementById("h2").innerHTML) ){

            document.getElementById('timenow').innerHTML =  h + ":" + m + ":" + s+ "left early!!";
          }
          setTimeout(startTime, 1000);
      }

        function checkTime(i) {
          if (i < 10) {i = "0" + i};  // add zero in front of numbers < 10
          return i;
        }
        startTime()

    // propmp locationn and camera 

       function getLoc(){
        if(document.getElementById("longitudes").value == ''){
            if(navigator.geolocation){

              navigator.geolocation.getCurrentPosition(getCoord);
              
              
            }else{
                
                alert("your device browser does not support")
            }
              
              
          }else{

              alert("details already recorded")
          }
        }
       function getCoord(position){

          var lat = position.coords.latitude;
          var long = position.coords.longitude;

         
          document.getElementById("longitudes").value = long
          document.getElementById("latitudes").value = lat
       }
      /**

       let camera_button = document.querySelector("#timenow");
        let video = document.querySelector("#video");
        let click_button = document.querySelector("#click-photo");
        let canvas = document.querySelector("#canvas");

        camera_button.addEventListener('click', async function() {
            let stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: false });
          video.srcObject = stream;
          
          document.getElementById("video_msg").innerHTML = "scroll down video initiated";

        });

        click_button.addEventListener('click', function() {
            canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height);
            let image_data_url = canvas.toDataURL('image/jpeg');

            // data url of the image
            //console.log(image_data_url);
            document.getElementById("image_info").value = image_data_url
            video.srcObject.getVideoTracks().forEach(track => track.stop());
        });
      **/
     
     

      const webcamElement = document.querySelector('video');
      const canvasElement = document.querySelector('canvas');
      const snapSoundElement = document.getElementById('snapSound');
      const webcam = new Webcam(webcamElement, 'user', canvasElement,snapSoundElement);
      webcam.start()
      .then(result =>{
      console.log("webcam started");
   })
   .catch(err => {
       console.log(err);
   });
   

   let click_button = document.querySelector("#click-photo");

   click_button.addEventListener('click', function() {
            	
        let picture = webcam.snap();
        document.getElementById("image_info").value = picture
        
        });

      // submit clock in details 

        function subClockin(){
            
          // check the location difference

          var lat1 = document.getElementById("lat1").value
          var long1 = document.getElementById("long1").value
          
          var long = document.getElementById("longitudes").value
          var lat = document.getElementById("latitudes").value

          var diff = distance(lat,long,lat1,long1)
          
       
          if(diff > 500000000000000000){
            alert("you are "+diff.toString() +" Metres  from clock in zone, denied!!")
          }else{

            webcam.stop()

             if($("#image_info").val() != '' && $("#longitudes").val() != ''){

             
          
             
            $.ajax({
              
              type:"POST",
              url:"{% url 'management-clock' %}",
              data: {

                 latitude: $("#latitudes").val(),
                 longitude: $("#longitudes").val(),
                 image_str:$("#image_info").val(),
                 csrfmiddlewaretoken:'{{ csrf_token }}'
              },
              beforeSend:function(){
                $("#loaders8").show()
             },

              success:function(data,status){
                 alert(data)
              },
              complete:function(){
                
                $("#loaders8").hide()
                
  
               }

            })
          }else{
            if($("#image_info").val()==''){
              alert("image not captured");
            }else if($("#longitudes").val() == ''){

              alert("location not captured, please allow location!!")

            }
          }
        }
      }
  
      // upload leave data 
 function loadLeave(){
  
     $("#leaveForm").submit(function(e){
      e.preventDefault()

      $form = $(this)
      var formData = new FormData(this);
    
      $.ajax({
        method:"post",
        url:"{% url 'management_upload_leave' %}",
        data:formData,
        processData: false,
   contentType: false,
   beforeSend:function(){
                $("#loaders6").show()
             },

        success:function(data,status){
          alert(data)
        },
        complete:function(){
                
                $("#loaders6").hide()
                
  
               }
      })
     })

 }

 // pull time of clock in and out 

 function getClock(){
/**
     $.ajax({
         
      url: "{% url 'management-get-attendance' %}",
      type:"GET",
      success:function(data,status){

         console.log(data)
      }

     })
  **/

  let fetchRes = fetch(

  "{% url 'management-get-attendance' %}"
  
  );
    // fetchRes is the promise to resolve
    // it by using.then() method
    fetchRes.then(res =>
        res.json()).then(d => {
           console.log(d)
           if(d["error"]){
            document.getElementById("statuss").innerHTML = d["error"];
            document.getElementById("statuss").style.color = "red"
           }
           document.getElementById("h1").innerHTML = d["h1"];
           document.getElementById("m1").innerHTML = d["m1"];
           document.getElementById("h2").innerHTML = d["h2"];
           document.getElementById("m2").innerHTML = d["m2"];
           document.getElementById("in").innerHTML = d["clock_in"];
           document.getElementById("out").innerHTML = d["clock_out"];
           document.getElementById("lat1").value = d["lat1"];
           document.getElementById("long1").value = d["long1"];

        })

 }


   
  
     
 
 var input1 = document.getElementById("id_start")
 input1.addEventListener("change",(event) => {

       var start = new Date(document.getElementById("id_start").value) 
       var end  = new Date(document.getElementById("id_end").value)
       if ((end-start)==0){

        document.getElementById("id_days").value = (end - start)/(24*3600000)+1

       }else if((end-start)>1){
        
            document.getElementById("id_days").value = (end - start)/(24*3600000)+1
       }
 })

 var input2 = document.getElementById("id_end")
 input2.addEventListener("change",(event) => {

       var start = new Date(document.getElementById("id_start").value) 
       var end  = new Date(document.getElementById("id_end").value)
       if ((end-start)==0){

        document.getElementById("id_days").value = (end - start)/(24*3600000)+1

       }else if((end-start)>1){
        
            document.getElementById("id_days").value = (end - start)/(24*3600000)+1
       }
 })

 document.getElementById("id_days").value = 1
 // calculate distance between clock in and set location

 function distance(lat1, lon1, lat2, lon2, unit) {
        var radlat1 = Math.PI * lat1/180
        var radlat2 = Math.PI * lat2/180
        var theta = lon1-lon2
        var radtheta = Math.PI * theta/180
        var dist = Math.sin(radlat1) * Math.sin(radlat2) + Math.cos(radlat1) * Math.cos(radlat2) * Math.cos(radtheta);
        dist = Math.acos(dist)
        dist = dist * 180/Math.PI
        dist = dist * 60 * 1.1515
        if (unit=="K") { dist = dist * 1.609344 }
        if (unit=="N") { dist = dist * 0.8684 }
        return dist*1000
}
    </script>
  {% endblock content %}

  
